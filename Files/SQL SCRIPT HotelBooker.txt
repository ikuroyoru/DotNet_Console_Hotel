DROP TABLE IF EXISTS hotels, rooms, clients, reservations;

CREATE TABLE hotels (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    name VARCHAR(255) NOT NULL,
    street VARCHAR(255) NOT NULL,
    number INT NOT NULL,
    city VARCHAR(255) NOT NULL,
    state VARCHAR(100) NOT NULL,
    country VARCHAR(100) NOT NULL,
    zip_code VARCHAR(9) NOT NULL,
    phone VARCHAR(20),
    room_count INT NOT NULL,
    is_active BOOL DEFAULT TRUE
);

ALTER TABLE hotels
ADD CONSTRAINT unique_hotel_location
UNIQUE (name, street, number, zip_code);

CREATE TABLE rooms (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    number INT NOT NULL,
    hotel_id UUID NOT NULL REFERENCES hotels(id) ON DELETE CASCADE,
    category VARCHAR(100) NOT NULL,
    price NUMERIC(10,2) NOT NULL
);

CREATE TABLE clients (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    name VARCHAR(255) NOT NULL,
    cpf CHAR(14) UNIQUE,
    email VARCHAR(255) NOT NULL UNIQUE,
    password VARCHAR(255) NOT NULL,
    status VARCHAR(50),
    last_login DATE,
    created_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT CURRENT_TIMESTAMP,
    phone VARCHAR(20),
    alternative_phone VARCHAR(20),
    street VARCHAR(255),
    house_number INT,
    city VARCHAR(255),
    state VARCHAR(100),
    country VARCHAR(100),
    zip_code VARCHAR(9)
);

CREATE TABLE reservations (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
	client_id UUID NOT NULL REFERENCES clients(id) ON DELETE CASCADE,
	room_id UUID NOT NULL REFERENCES rooms(id) ON DELETE CASCADE,
	checkin_date TIMESTAMP WITH TIME ZONE NOT NULL,
	checkout_date TIMESTAMP WITH TIME ZONE NOT NULL
);


-- Seleção para conferir
SELECT * FROM clients;
SELECT * FROM rooms;
SELECT * FROM hotels;
SELECT * FROM reservations;

SELECT 
    r.number AS room_number,
    c.name AS client_name,
    res.checkin_date,
    res.checkout_date
FROM reservations res
JOIN rooms r ON res.room_id = r.id
JOIN clients c ON res.client_id = c.id
ORDER BY res.checkin_date;